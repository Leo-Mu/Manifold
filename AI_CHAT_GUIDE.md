# 🤖 AI 对话功能使用指南

## 功能概述

Vibe Context Manager 现在支持完整的AI对话功能，让你可以：
- 配置多种AI提供商（OpenAI、Anthropic、自定义API）
- 基于历史上下文进行智能对话
- 管理多个对话会话
- 自由组合上下文片段进行精准提问

## 快速开始

### 1. 配置 AI 提供商

使用命令面板 (`Ctrl+Shift+P`) 执行：
```
Vibe Context: 配置 AI 提供商
```

支持的提供商：
- **OpenAI**: 使用 GPT-3.5/GPT-4 模型
- **Anthropic**: 使用 Claude 模型  
- **自定义 API**: 兼容 OpenAI 格式的任何 API

### 2. 基本对话

#### 方式一：快捷键对话
- `Ctrl+Shift+A`: 打开完整的AI对话界面
- `Ctrl+K Ctrl+A`: 基于选中上下文快速对话

#### 方式二：命令面板
```
Vibe Context: 打开 AI 对话界面
Vibe Context: 基于上下文对话
```

## 核心功能

### 🎯 上下文智能组合

1. **解析历史内容**
   ```
   Vibe Context: 解析当前对话
   ```
   自动提取代码块、JSON数据、问答对话

2. **选择相关上下文**
   - 在对话界面中点击上下文标签
   - 支持多选，灵活组合
   - 实时预览选中内容

3. **智能对话**
   - AI会基于选中的上下文回答问题
   - 保持上下文连贯性
   - 支持多轮对话

### 💬 对话会话管理

- **新建对话**: 创建独立的对话会话
- **会话历史**: 查看所有历史对话
- **会话切换**: 在不同对话间快速切换
- **会话删除**: 清理不需要的对话记录

### ⚙️ 高级配置

#### 系统提示词
在对话界面中可以设置自定义系统提示词：
```
你是一个专业的代码审查专家，请仔细分析提供的代码并给出改进建议。
```

#### API 配置流程

**OpenAI 配置**:
1. 选择 "OpenAI" 提供商
2. 输入 API Key (以 `sk-` 开头)
3. 选择是否使用自定义 API 地址（代理等）
4. 选择模型：`gpt-3.5-turbo`, `gpt-4`, `gpt-4-turbo-preview` 等

**Anthropic 配置**:
1. 选择 "Anthropic (Claude)" 提供商
2. 输入 API Key (以 `sk-ant-` 开头)
3. 选择模型：`claude-3-haiku`, `claude-3-sonnet`, `claude-3-opus`

**自定义 API 配置**:
1. 选择 "自定义 API" 提供商
2. **必须输入完整的 API 端点地址**
   - 示例：`https://your-api.com/v1/chat/completions`
   - 支持各种兼容 OpenAI 格式的 API
3. 输入对应的 API Key
4. 输入模型名称
5. 可选：配置高级参数（温度、最大Token等）

#### 支持的自定义 API 服务

- **本地部署**：Ollama, LocalAI, Text Generation WebUI
- **云服务**：Azure OpenAI, 各种代理服务
- **开源模型**：通过兼容接口部署的各种开源模型

## 使用场景

### 📝 代码分析与优化
```markdown
1. 解析包含代码的对话记录
2. 选择相关代码片段作为上下文
3. 询问："这段代码有什么可以优化的地方？"
```

### 🔍 技术问题解答
```markdown
1. 收集相关的技术文档和代码示例
2. 组合多个上下文片段
3. 提问具体的技术问题
```

### 📚 知识整理与总结
```markdown
1. 选择多个相关的问答对话
2. 要求AI总结关键要点
3. 生成结构化的知识文档
```

## 快捷键速查

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+Shift+V` | 打开上下文管理器 |
| `Ctrl+Shift+A` | 打开AI对话界面 |
| `Ctrl+K Ctrl+C` | 组合上下文 |
| `Ctrl+K Ctrl+A` | 基于上下文对话 |

## 注意事项

### 🔒 隐私与安全
- API Key 仅存储在本地，不会上传
- 对话记录保存在工作区，可随时删除
- 支持自定义API，保护数据隐私

### 💰 成本控制
- 可配置最大Token数量
- 显示每次对话的Token使用情况
- 建议设置合理的温度参数（0.7）

### 🚀 性能优化
- 合理选择上下文数量（建议5-10个）
- 定期清理不需要的对话会话
- 使用简洁明确的提问方式

## 故障排除

### 常见问题

**Q: API调用失败**
- 检查API Key格式是否正确（OpenAI: `sk-`, Anthropic: `sk-ant-`）
- 确认网络连接正常
- 验证API地址是否完整和正确
- 检查模型名称是否支持

**Q: 自定义API无法连接**
- 确保API地址包含完整路径（如 `/v1/chat/completions`）
- 验证API服务是否兼容OpenAI格式
- 检查防火墙和网络设置
- 测试API地址是否可访问

**Q: 上下文没有被识别**
- 确保文件格式正确（Markdown等）
- 检查代码块是否有正确的语言标识
- 尝试重新解析当前对话
- 使用"显示上下文统计"命令检查解析结果

**Q: 对话响应慢**
- 减少上下文数量
- 降低最大Token设置
- 检查网络延迟
- 尝试使用更快的模型（如gpt-3.5-turbo）

**Q: 配置丢失**
- 配置保存在工作区设置中
- API Key等敏感信息需要重新输入
- 可以使用"配置AI提供商"命令重新设置

## 更新日志

### v0.1.0
- ✅ 支持 OpenAI、Anthropic、自定义 API
- ✅ 智能上下文组合
- ✅ 多会话管理
- ✅ 可视化对话界面
- ✅ 快捷键操作

---

🎉 享受智能的上下文对话体验！如有问题，请查看插件日志或提交反馈。